<!DOCTYPE html>
<html lang="en"><head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Meu Fazendão - Expense Management</title>
<script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
<link href="https://fonts.googleapis.com" rel="preconnect"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;900&amp;display=swap" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet"/>
<script>
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#13ec49",
                        "background-light": "#f6f8f6",
                        "background-dark": "#102215",
                        "content-light": "#f8fcf9",
                        "content-dark": "#1a2c1f",
                        "text-light": "#0d1b11",
                        "text-dark": "#e0f1e5",
                        "subtle-light": "#4c9a5f",
                        "subtle-dark": "#a2d8b0",
                        "border-light": "#cfe7d5",
                        "border-dark": "#2c4832",
                        "primary-text": "#0d1b11",
                    },
                    fontFamily: {
                        "display": ["Inter", "sans-serif"]
                    },
                    borderRadius: {
                        "DEFAULT": "0.5rem",
                        "lg": "0.75rem",
                        "xl": "1rem",
                        "full": "9999px"
                    },
                },
            },
        }
    </script>
<style>
        .material-symbols-outlined {
            font-variation-settings:
            'FILL' 0,
            'wght' 400,
            'GRAD' 0,
            'opsz' 24
        }
    </style>
</head>
<body class="bg-background-light dark:bg-background-dark font-display">
<div class="flex min-h-screen">
<aside class="w-64 shrink-0 bg-background-light dark:bg-background-dark border-r border-surface-light dark:border-surface-dark/20 p-4 flex flex-col justify-between relative">
<div>
<div class="flex flex-col gap-6">
<div class="flex items-center gap-3 px-2">
<div class="bg-center bg-no-repeat aspect-square bg-cover rounded-full size-10" data-alt="FarmFlow logo with a green leaf" style='background-image: url("https://lh3.googleusercontent.com/aida-public/AB6AXuDaPU_TaCX74M4e9lKS0oP0681Av1h4Dh3a6XRWvQFjRHK2TTWjlR6Kks3hmq5X0FXJduXwldWfEnShJ_rtKy3ysgIPIgw6uVet4XX4inibLEh9EKc7dYbJjMJf_5F4pmjsQOXIAS_xm-GMMwA16K-fxhvmIdU9QhEPXebvApRQASo12VCH78trXoMSOYWeatrltVxau1WJs0wY-t7_Fr29oJK36M1oPzTUZ97IHfb7ISuYVQNcl7sauDv3jFMcY5W68Qf_MvByPKx5");'></div>
<div class="flex flex-col">
<h1 class="text-text-light-primary dark:text-text-dark-primary text-base font-bold leading-normal">Meu Fazendão</h1>
<p class="text-text-light-secondary dark:text-text-dark-secondary text-sm font-normal leading-normal">Management Suite</p>
</div>
</div>
<nav class="flex flex-col gap-2">
<a class="flex items-center gap-3 px-3 py-2 rounded-DEFAULT text-text-light-primary dark:text-text-dark-primary hover:bg-surface-light dark:hover:bg-surface-dark" href="{{ url_for('dashboard') }}">
<span class="material-symbols-outlined text-2xl">dashboard</span>
<p class="text-sm font-medium leading-normal">Dashboard</p>
</a>
<a class="flex items-center gap-3 px-3 py-2 rounded-DEFAULT bg-primary/20 dark:bg-primary/30 text-text-light-primary dark:text-text-dark-primary" href="{{ url_for('expenses') }}">
<span class="material-symbols-outlined text-2xl" style="font-variation-settings: 'FILL' 1;">receipt_long</span>
<p class="text-sm font-bold leading-normal">Expenses</p>
</a>
<a class="flex items-center gap-3 px-3 py-2 rounded-DEFAULT text-text-light-primary dark:text-text-dark-primary hover:bg-surface-light dark:hover:bg-surface-dark" href="{{ url_for('machinery') }}">
<span class="material-symbols-outlined text-2xl">agriculture</span>
<p class="text-sm font-medium leading-normal">Machinery</p>
</a>
<a class="flex items-center gap-3 px-3 py-2 rounded-DEFAULT text-text-light-primary dark:text-text-dark-primary hover:bg-surface-light dark:hover:bg-surface-dark" href="{{ url_for('products') }}">
<span class="material-symbols-outlined text-2xl">inventory_2</span>
<p class="text-sm font-medium leading-normal">Products</p>
</a>
<a class="flex items-center gap-3 px-3 py-2 rounded-DEFAULT text-text-light-primary dark:text-text-dark-primary hover:bg-surface-light dark:hover:bg-surface-dark" href="{{ url_for('harvest') }}">
<span class="material-symbols-outlined text-2xl">grass</span>
<p class="text-sm font-medium leading-normal">Harvests</p>
</a>
</nav>
</div>
<button class="absolute -right-4 top-1/2 -translate-y-1/2 w-8 h-8 flex items-center justify-center bg-background-light dark:bg-surface-dark border border-surface-light dark:border-surface-dark/20 rounded-full text-text-light-primary dark:text-text-dark-primary hover:bg-surface-light dark:hover:bg-surface-dark focus:outline-none focus:ring-2 focus:ring-primary/50">
<span class="material-symbols-outlined text-xl">chevron_left</span>
</button>
</div>
<div class="flex flex-col gap-2">
<a class="flex items-center gap-3 px-3 py-2 rounded-DEFAULT text-text-light-primary dark:text-text-dark-primary hover:bg-surface-light dark:hover:bg-surface-dark" href="">
<span class="material-symbols-outlined text-2xl">help</span>
<p class="text-sm font-medium leading-normal">Help</p>
</a>
<a class="flex items-center gap-3 px-3 py-2 rounded-DEFAULT text-text-light-primary dark:text-text-dark-primary hover:bg-surface-light dark:hover:bg-surface-dark" href="#">
<span class="material-symbols-outlined text-2xl">settings</span>
<p class="text-sm font-medium leading-normal">Settings</p>
</a>
</div>
</aside>
<main class="flex-1 p-6 lg:p-8">
<div class="w-full max-w-7xl mx-auto">
<header class="mb-6">
<h1 class="text-text-light-primary dark:text-text-dark-primary text-4xl font-black leading-tight tracking-[-0.033em]">Expense Management</h1>
</header>
<div class="flex flex-col md:flex-row gap-4 mb-4">
<div class="flex-1">
<label class="flex flex-col w-full">
<div class="flex w-full flex-1 items-stretch rounded-DEFAULT h-12">
<div class="text-text-light-secondary dark:text-text-dark-secondary flex bg-surface-light dark:bg-surface-dark items-center justify-center pl-4 rounded-l-DEFAULT border-r-0">
<span class="material-symbols-outlined text-2xl">search</span>
</div>
<input class="form-input flex w-full min-w-0 flex-1 resize-none overflow-hidden rounded-DEFAULT text-text-light-primary dark:text-text-dark-primary focus:outline-0 focus:ring-2 focus:ring-primary/50 border-none bg-surface-light dark:bg-surface-dark h-full placeholder:text-text-light-secondary dark:placeholder:text-text-dark-secondary px-4 rounded-l-none border-l-0 pl-2 text-base font-normal leading-normal" placeholder="Search by description or machine..." value=""/>
</div>
</label>
</div>
<div class="flex items-center gap-3">
<button class="flex h-12 shrink-0 items-center justify-center gap-x-2 rounded-DEFAULT bg-surface-light dark:bg-surface-dark px-4">
<span class="material-symbols-outlined text-xl text-text-light-primary dark:text-text-dark-primary">calendar_today</span>
<p class="text-text-light-primary dark:text-text-dark-primary text-sm font-medium leading-normal">Date Range</p>
<span class="material-symbols-outlined text-xl text-text-light-primary dark:text-text-dark-primary">arrow_drop_down</span>
</button>
<button class="flex h-12 shrink-0 items-center justify-center gap-x-2 rounded-DEFAULT bg-surface-light dark:bg-surface-dark px-4">
<span class="material-symbols-outlined text-xl text-text-light-primary dark:text-text-dark-primary">sell</span>
<p class="text-text-light-primary dark:text-text-dark-primary text-sm font-medium leading-normal">Category: All</p>
<span class="material-symbols-outlined text-xl text-text-light-primary dark:text-text-dark-primary">arrow_drop_down</span>
</button>
</div>
<button onclick="openModal()" class="flex min-w-[84px] max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-lg h-10 px-4 bg-primary text-primary-text text-sm font-bold leading-normal tracking-[0.015em]">
<span class="truncate">Add New Expense</span>
</button>
</div>
<div class="bg-white dark:bg-surface-dark/40 rounded-lg shadow-sm overflow-hidden">
<div class="overflow-x-auto">
<table class="w-full text-left">
<thead class="bg-surface-light dark:bg-surface-dark/60">
<tr>
<th class="p-4 w-12"><input class="form-checkbox rounded border-gray-400 dark:border-gray-600 text-primary focus:ring-primary/50 bg-transparent dark:bg-transparent" type="checkbox"/></th>
<th class="p-4 text-sm font-semibold text-text-light-secondary dark:text-text-dark-secondary tracking-wider">Date</th>
<th class="p-4 text-sm font-semibold text-text-light-secondary dark:text-text-dark-secondary tracking-wider">Category</th>
<th class="p-4 text-sm font-semibold text-text-light-secondary dark:text-text-dark-secondary tracking-wider">Description</th>
<th class="p-4 text-sm font-semibold text-text-light-secondary dark:text-text-dark-secondary tracking-wider">Machine</th>
<th class="p-4 text-sm font-semibold text-text-light-secondary dark:text-text-dark-secondary tracking-wider text-right">Amount</th>
<th class="p-4 text-sm font-semibold text-text-light-secondary dark:text-text-dark-secondary tracking-wider text-center">Actions</th>
</tr>
</thead>

<tbody class="divide-y divide-surface-light dark:divide-surface-dark/20">
    {% for e in expenses %}
        <tr>
            <td class="p-4"><input class="form-checkbox rounded border-gray-400 dark:border-gray-600 text-primary focus:ring-primary/50 bg-transparent dark:bg-transparent" type="checkbox"/></td>
                <td class="p-4 text-sm text-text-light-primary dark:text-text-dark-primary whitespace-nowrap">{{e.data}}</td>
                <td class="p-4 text-sm text-text-light-primary dark:text-text-dark-primary"><span class="px-2 py-1 text-xs font-medium rounded-full bg-blue-100 text-blue-800 dark:bg-blue-900/50 dark:text-blue-200">{{e.categoria}}</span></td>
                <td class="p-4 text-sm text-text-light-primary dark:text-text-dark-primary">{{e.nome}}</td>
                <td class="p-4 text-sm text-text-light-primary dark:text-text-dark-primary">{{e.machine}}</td>
                <td class="p-4 text-sm text-text-light-primary dark:text-text-dark-primary text-right font-medium">R$ {{e.valor}}</td>
                <td class="p-4 text-center">
                <div class="flex justify-center gap-2">
                    <button onclick="openEditModal('{{ e.id }}', '{{ e.nome }}', '{{ e.valor }}', '{{e.machine}}', '{{e.data}}')" class="p-2 rounded-full hover:bg-surface-light dark:hover:bg-surface-dark text-text-light-secondary dark:text-text-dark-secondary"><span class="material-symbols-outlined text-xl">edit</span></button>
                <form action="/deletar_expense" method="POST">
                    <input type="hidden" name="id" value="{{ e.id }}">
                    <button class="p-2 rounded-full hover:bg-surface-light dark:hover:bg-surface-dark text-red-500">
                        <span class="material-symbols-outlined text-xl">delete</span>
                    </button>
                </form>
                </div>
            </td>
        </tr>
    {% endfor %}
</tbody>

</table>
</div>
<div class="flex items-center justify-between p-4 border-t border-surface-light dark:border-surface-dark/20">
<span class="text-sm text-text-light-secondary dark:text-text-dark-secondary">Showing 1 to 4 of 57 results</span>
<div class="flex items-center gap-2">
<button class="px-3 py-1.5 rounded-DEFAULT text-sm font-medium bg-surface-light dark:bg-surface-dark text-text-light-primary dark:text-text-dark-primary hover:bg-primary/20 dark:hover:bg-primary/30 disabled:opacity-50" disabled="">Previous</button>
<button class="px-3 py-1.5 rounded-DEFAULT text-sm font-medium bg-surface-light dark:bg-surface-dark text-text-light-primary dark:text-text-dark-primary hover:bg-primary/20 dark:hover:bg-primary/30">Next</button>
</div>
</div>
</div>
</div>
</main>
</div>

<div id="expenseModal" 
     class="fixed inset-0 z-50 hidden items-center justify-center p-4 sm:p-6 lg:p-8 bg-black/50 backdrop-blur-sm">

    <div class="bg-background-light dark:bg-background-dark w-full max-w-2xl rounded-xl shadow-2xl 
                border border-black/10 dark:border-white/10 p-6 sm:p-8">

        <!-- Título -->
        <div class="flex justify-between items-start mb-6">
            <div>
                <p class="text-2xl sm:text-3xl font-black text-[#0d1b11] dark:text-white">
                    Add New Expense
                </p>
                <p class="text-base text-[#4c9a5f] dark:text-primary/70">
                    Fill in the details below to log a new expense.
                </p>
            </div>

            <!-- Botão fechar -->
            <button onclick="closeModal()" class="text-[#0d1b11] dark:text-white text-3xl leading-none">
                ×
            </button>
        </div>

        <!-- Conteúdo do Formulário -->
        <form method="POST">
        <div class="space-y-6">

            <div class="flex flex-col">
                <label class="text-sm font-medium pb-2 text-[#0d1b11] dark:text-white/90">
                    Expense Name/Description
                </label>
                <input name='expense_name' class="form-input rounded-lg border border-[#cfe7d5] dark:border-white/20
                             bg-background-light dark:bg-white/5 h-12 p-3"
                       id="expense-name" type="text"
                       placeholder="e.g. Tractor fuel purchase">
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">

                <div class="flex flex-col">
                    <label class="text-sm font-medium pb-2 text-[#0d1b11] dark:text-white/90">
                        Category
                    </label>
                    <select name='categoria' class="form-select rounded-lg border border-[#cfe7d5] dark:border-white/20 
                                   bg-background-light dark:bg-white/5 h-12 p-3">
                        <option value="">Select a category</option>
                        <option value="fuel">Fuel</option>
                        <option value="seeds">Seeds</option>
                        <option value="maintenance">Maintenance</option>
                        <option value="fertilizer">Fertilizer</option>
                        <option value="labor">Labor</option>
                    </select>
                </div>

                <div class="flex flex-col">
                    <label class="text-sm font-medium pb-2 text-[#0d1b11] dark:text-white/90">
                        Associate with Machine (Optional)
                    </label>
                    <select name="machine" class="form-select rounded-lg border border-[#cfe7d5] dark:border-white/20 
                                   bg-background-light dark:bg-white/5 h-12 p-3">
                        <option value="">Select a machine</option>
                        <option value="tractor-1">John Deere 8R 370</option>
                        <option value="harvester-1">Claas Lexion 8900</option>
                        <option value="sprayer-1">Case IH Patriot 4440</option>
                    </select>
                </div>

            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">

                <div class="flex flex-col">
                    <label class="text-sm font-medium pb-2 text-[#0d1b11] dark:text-white/90">
                        Amount
                    </label>
                    <div class="relative">
                        <span class="absolute inset-y-0 left-3 flex items-center text-[#4c9a5f]">$</span>
                        <input name="valor" class="form-input rounded-lg border border-[#cfe7d5] dark:border-white/20
                                     bg-background-light dark:bg-white/5 h-12 pl-7 p-3 w-full">
                    </div>
                </div>

                <div class="flex flex-col">
                    <label class="text-sm font-medium pb-2 text-[#0d1b11] dark:text-white/90">
                        Date
                    </label>
                    <input name='date' type="date"
                           class="form-input rounded-lg border border-[#cfe7d5] dark:border-white/20 
                                  bg-background-light dark:bg-white/5 h-12 p-3">
                </div>

            </div>

        </div>

        <!-- Botões -->
        <div class="flex flex-col sm:flex-row-reverse gap-3 pt-6">

            <button class="flex w-full sm:w-auto justify-center rounded-lg h-11 px-6 
                           bg-primary text-[#0d1b11] text-sm font-bold">
                Save Expense
            </button>

            <button onclick="closeModal()"
                    class="flex w-full sm:w-auto justify-center rounded-lg h-11 px-6 
                           bg-primary/20 hover:bg-primary/30 
                           dark:bg-white/10 dark:hover:bg-white/20 
                           text-[#0d1b11] dark:text-white text-sm font-bold">
                Cancel
            </button>
        
        </div>
        </form>

    </div>
</div>

<!-- Modal EDITAR -->
<div id="editModal" class="fixed inset-0 bg-black/50 flex items-center justify-center p-4 hidden z-50">

    <div class="w-full max-w-lg rounded-xl bg-background-light dark:bg-background-dark shadow-2xl">

        <div class="flex items-center justify-between border-b p-6">
            <h3 class="text-2xl font-bold">Editar Despesa</h3>
            <button id="closeEditModal" class="text-gray-400 hover:text-gray-600">
                <span class="material-symbols-outlined">close</span>
            </button>
        </div>

        <form action="/edit_expense" id="editForm" method="POST" class="px-6 py-8 flex flex-col gap-6">

            <input type="hidden" name="id" id="edit-id">

            <label class="flex flex-col">
                <span class="font-medium">Nome</span>
                <input id="editName" name="name" class="form-input h-12 rounded-lg px-4 border" required>
            </label>

            <label class="flex flex-col">
                <span class="font-medium">Categoria</span>
                <select id="editCategory" name="categoria" class="form-select h-12 rounded-lg px-4 border">
                    <option value="Fuel">Fuel</option>
                    <option value="Maintenance">Maintenance</option>
                    <option value="Seeds">Seeds</option>
                    <option value="Fertilizer">Fertilizer</option>
                </select>
            </label>

            <label class="flex flex-col">
                <span class="font-medium">Valor</span>
                <input id="editAmount" name="valor" type="number" step="0.01" class="form-input h-12 rounded-lg px-4 border" required>
            </label>

            <label class="flex flex-col">
                <span class="font-medium">Data</span>
                <input id="editDate" name="date" type="date" class="form-input h-12 rounded-lg px-4 border" required>
            </label>

            <label class="flex flex-col">
                <span class="font-medium">Máquina (opcional)</span>
                <input id="editMachine" name="machine" class="form-input h-12 rounded-lg px-4 border">
            </label>

            <div onclick="closeEditModal()" class="flex justify-end gap-4 pt-4">
                <button type="button" id="closeEditModal"
                    class="px-6 py-2 rounded-lg border">
                    Cancelar
                </button>

                <button type="submit"
                    class="px-6 py-2 rounded-lg bg-primary text-black hover:bg-primary/90">
                    Salvar
                </button>
            </div>

        </form>
    </div>
</div>

<script>
function openModal() {
    document.getElementById("expenseModal").classList.remove("hidden");
    document.getElementById("expenseModal").classList.add("flex");
}

function closeModal() {
    document.getElementById("expenseModal").classList.remove("flex");
    document.getElementById("expenseModal").classList.add("hidden");
}
</script>


<script>

function openEditModal(id, nome, valor, machine, data) {
    document.getElementById("editModal").classList.remove("hidden");
    document.getElementById("editModal").classList.add("flex");

    document.getElementById("edit-id").value = id;
    document.getElementById("editName").value = nome;
    document.getElementById("editAmount").value = valor;
    document.getElementById("editMachine").value = machine;
    document.getElementById("editDate").value = data;

    // garantir que está enviando para a rota certa
    const form = document.getElementById("editForm");
    form.action = "/edit_expense";
}

// FECHAR MODAL 
function closeEditModal() 
{ document.getElementById("editModal").classList.remove("flex"); document.getElementById("editModal").classList.add("hidden"); }

</script>


</body></html>